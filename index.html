<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai chat ui</title>
    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="./ai-chat.css">
  </head>
  <body>
    <div id="chat-box"></div>
    <form id="chat-form">
      <input type="text" id="chat-input" placeholder="질문을 입력하세요..." />
      <button type="submit">전송</button>
    </form>

    <!-- 마크다운 파싱 라이브러리 필수-->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="./ai-chat.js"></script>
    <script>
      // 초기 설정과 함께 인스턴스 생성
      const chatService = new StreamHandler("#chat-box", {
        endpoint: "https://api.openai.com/v1/chat/completions",
        headers: {
          Authorization:
            "Bearer API_KEY(본인것)",
          "Content-Type": "application/json",
        },
        onStart: () => {
          console.log('질문 시작!')
        },
        onComplete: () => {
          console.log("답변 완료!");
        },
      });

      const chatForm = document.querySelector("#chat-form");
      const chatInput = document.querySelector("#chat-input");

      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const userInput = chatInput.value.trim();
        if (!userInput) return;

        chatInput.value = "";

        // submitQuestion 메소드 사용
        await chatService.submitQuestion({
          model: "gpt-4",
          messages: [{ role: "user", content: userInput }],
          stream: true,
        });
      });
    </script>
  </body>
</html>
